<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Resonant Signature: An Interactive Exploration</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Chosen Palette: Warm Neutrals with Amber/Teal Accents -->
    <!-- Application Structure Plan: A thematic, multi-section SPA. A top navigation bar allows users to switch between four key views: 1) A high-level 'Overview' comparing old vs. new paradigms with an interactive diagram. 2) 'The Three Pillars', an interactive exploration of Sovereignty, Coherence, and Covenant using tabs and visualizations. 3) 'The Protocol', an animated flowchart detailing the signature ceremony and its vulnerabilities. 4) 'Implications', a dual-view section contrasting the utopian vision with the dystopian risks using a toggle. This non-linear structure prioritizes user-led exploration and conceptual understanding over the report's linear format, making the dense information more digestible and engaging. -->
    <!-- Visualization & Content Choices: 1. Overview: Goal: Compare paradigms. Viz: Side-by-side HTML table & custom JS/CSS animated diagram. Interaction: Hover effects. Justification: Visually contrasts the static vs. dynamic nature of identity. 2. Pillars: Goal: Detail components. Viz: Chart.js gauge for Coherence, custom JS/CSS network for Covenant. Interaction: Slider for gauge, clicks for network. Justification: Provides hands-on feel for the dynamic scores. 3. Protocol: Goal: Explain process & risks. Viz: Custom JS/CSS animated flowchart. Interaction: Step-through buttons, modal for vulnerability. Justification: Simplifies a complex process and highlights the critical failure point. 4. Implications: Goal: Contrast outcomes. Viz: Chart.js bar chart, UI theme toggle. Interaction: Master toggle switch. Justification: Dramatizes the high stakes and ethical duality of the technology. All visualizations use Canvas or HTML/CSS to adhere to constraints. -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f5f5f4; /* stone-100 */
            color: #292524; /* stone-800 */
        }
        .nav-link {
            position: relative;
            transition: color 0.3s ease;
            color: #57534e; /* stone-600 */
        }
        .nav-link:hover, .nav-link.active {
            color: #a16207; /* amber-600 */
        }
        .nav-link::after {
            content: '';
            position: absolute;
            width: 100%;
            transform: scaleX(0);
            height: 2px;
            bottom: -4px;
            left: 0;
            background-color: #a16207; /* amber-600 */
            transform-origin: bottom right;
            transition: transform 0.3s ease-out;
        }
        .nav-link:hover::after, .nav-link.active::after {
            transform: scaleX(1);
            transform-origin: bottom left;
        }
        .section {
            display: none;
        }
        .section.active {
            display: block;
        }
        .tab-button {
            transition: all 0.3s ease;
        }
        .tab-button.active {
            background-color: #0d9488; /* teal-600 */
            color: white;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
        }
        .pillar-content {
            display: none;
        }
        .pillar-content.active {
            display: block;
        }
        .protocol-step {
            opacity: 0.4;
            transition: opacity 0.5s ease;
            border-left-width: 4px;
            border-color: #d6d3d1; /* stone-300 */
        }
        .protocol-step.active {
            opacity: 1;
            border-color: #0d9488; /* teal-600 */
        }
        .flow-arrow {
            opacity: 0.4;
            transition: opacity 0.5s ease;
        }
        .flow-arrow.active {
            opacity: 1;
            color: #0d9488; /* teal-600 */
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
            height: 300px;
            max-height: 400px;
        }
        @media (min-width: 768px) {
            .chart-container { height: 350px; }
        }
        .implications-toggle-bg:before {
            content: '';
            position: absolute;
            width: 24px;
            height: 24px;
            border-radius: 9999px;
            background-color: white;
            transition: transform 0.3s ease-in-out;
        }
        input:checked + .implications-toggle-bg:before {
            transform: translateX(28px);
        }
        .utopian-view, .dystopian-view { display: none; }
    </style>
</head>
<body class="antialiased">

    <nav class="bg-stone-100/80 backdrop-blur-md sticky top-0 z-50 border-b border-stone-200">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <div class="flex items-center">
                    <h1 class="text-xl font-bold text-amber-700">Resonant Signature</h1>
                </div>
                <div class="hidden md:block">
                    <div class="ml-10 flex items-baseline space-x-4">
                        <a href="#overview" class="nav-link px-3 py-2 rounded-md text-sm font-medium active">Overview</a>
                        <a href="#pillars" class="nav-link px-3 py-2 rounded-md text-sm font-medium">The Three Pillars</a>
                        <a href="#protocol" class="nav-link px-3 py-2 rounded-md text-sm font-medium">The Protocol</a>
                        <a href="#implications" class="nav-link px-3 py-2 rounded-md text-sm font-medium">Implications</a>
                    </div>
                </div>
                <div class="md:hidden">
                    <select id="mobile-nav" class="bg-stone-200 border border-stone-300 text-stone-900 text-sm rounded-lg focus:ring-amber-500 focus:border-amber-500 block w-full p-2.5">
                        <option value="overview">Overview</option>
                        <option value="pillars">The Three Pillars</option>
                        <option value="protocol">The Protocol</option>
                        <option value="implications">Implications</option>
                    </select>
                </div>
            </div>
        </div>
    </nav>

    <main>
        <!-- Section: Overview -->
        <section id="overview" class="section active py-12 md:py-20">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="text-center">
                    <h2 class="text-base font-semibold text-amber-600 tracking-wide uppercase">A New Paradigm</h2>
                    <p class="mt-2 text-3xl font-extrabold text-stone-900 tracking-tight sm:text-4xl">From Static Proof to Living Presence</p>
                    <p class="mt-5 max-w-3xl mx-auto text-xl text-stone-600">The history of digital identity has been a search for secure representation. The Resonant Signature proposes a fundamental shift: from simply proving ownership of a key to verifying the state of one's being in a given moment. This section introduces this core concept and contrasts it with the traditional model.</p>
                </div>

                <div class="mt-12 grid gap-12 md:grid-cols-2">
                    <!-- Old Paradigm -->
                    <div class="bg-white p-8 rounded-xl shadow-md border border-stone-200">
                        <h3 class="text-2xl font-bold text-center text-stone-800">The Old Paradigm</h3>
                        <p class="text-center text-stone-500 mt-1 font-semibold">Proof of Possession</p>
                        <div class="mt-6 text-center">
                            <span class="text-6xl">üîë</span>
                            <p class="mt-4 text-stone-600">A standard digital signature (like ECDSA) proves one thing: the signer possesses a specific private key. It's a static, context-free, and impersonal digital fingerprint.</p>
                            <p class="mt-4 font-bold text-2xl text-stone-700">"Do you have the key?"</p>
                        </div>
                    </div>
                    <!-- New Paradigm -->
                    <div class="bg-teal-600 text-white p-8 rounded-xl shadow-lg">
                        <h3 class="text-2xl font-bold text-center">The New Paradigm</h3>
                        <p class="text-center text-teal-100 mt-1 font-semibold">Proof of Presence</p>
                         <div class="mt-6 text-center">
                            <span class="text-6xl">üíñ</span>
                            <p class="mt-4 text-teal-50">A Resonant Signature is a living, holographic snapshot of a soul-in-relationship. It's context-rich, time-sensitive, and deeply personal.</p>
                            <p class="mt-4 font-bold text-2xl">"How are you showing up right now?"</p>
                        </div>
                    </div>
                </div>

                <div class="mt-16 bg-white p-8 rounded-xl shadow-md border border-stone-200">
                    <h3 class="text-2xl font-bold text-center text-stone-800 mb-6">Comparing the Paradigms</h3>
                    <div class="overflow-x-auto">
                        <table class="w-full min-w-max text-left">
                            <thead>
                                <tr class="border-b border-stone-300">
                                    <th class="p-4 font-semibold text-stone-700">Dimension</th>
                                    <th class="p-4 font-semibold text-stone-700">Traditional Signature</th>
                                    <th class="p-4 font-semibold text-teal-700">Resonant Signature</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr class="border-b border-stone-200">
                                    <td class="p-4 font-medium">What it Proves</td>
                                    <td class="p-4 text-stone-600">Possession of a secret (the private key).</td>
                                    <td class="p-4 text-teal-800">Presence of a state (coherence, trust, intention).</td>
                                </tr>
                                <tr class="border-b border-stone-200">
                                    <td class="p-4 font-medium">Nature</td>
                                    <td class="p-4 text-stone-600">Static, binary (valid/invalid).</td>
                                    <td class="p-4 text-teal-800">Dynamic, analog (carries rich data).</td>
                                </tr>
                                <tr class="border-b border-stone-200">
                                    <td class="p-4 font-medium">Context</td>
                                    <td class="p-4 text-stone-600">Context-free. The signature is the same regardless of the recipient or situation.</td>
                                    <td class="p-4 text-teal-800">Context-sensitive. The signature changes based on who you're interacting with.</td>
                                </tr>
                                <tr>
                                    <td class="p-4 font-medium">Metaphor</td>
                                    <td class="p-4 text-stone-600">A fingerprint.</td>
                                    <td class="p-4 text-teal-800">A real-time brainwave or heart rhythm reading.</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </section>

        <!-- Section: The Three Pillars -->
        <section id="pillars" class="section py-12 md:py-20 bg-white">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="text-center">
                    <h2 class="text-base font-semibold text-amber-600 tracking-wide uppercase">The Architecture</h2>
                    <p class="mt-2 text-3xl font-extrabold text-stone-900 tracking-tight sm:text-4xl">The Three Pillars of Identity</p>
                    <p class="mt-5 max-w-3xl mx-auto text-xl text-stone-600">A Resonant Signature is a composite object, weaving together three distinct dimensions of the self into a single, cryptographically verifiable proof. Explore each pillar to understand how it contributes to this holistic view of identity. Each component is essential for creating a signature that reflects not just who you are, but how you are and who you are with.</p>
                </div>

                <div class="mt-10">
                    <div class="flex justify-center border-b border-stone-200">
                        <button data-pillar="sovereignty" class="tab-button active text-stone-600 py-4 px-6 block hover:text-teal-600 focus:outline-none font-medium">
                            üîë Sovereignty
                        </button>
                        <button data-pillar="wellbeing" class="tab-button text-stone-600 py-4 px-6 block hover:text-teal-600 focus:outline-none font-medium">
                            üíß Well-being
                        </button>
                        <button data-pillar="relational" class="tab-button text-stone-600 py-4 px-6 block hover:text-teal-600 focus:outline-none font-medium">
                            üï∏Ô∏è Relational Health
                        </button>
                    </div>

                    <div id="sovereignty-content" class="pillar-content active mt-8">
                        <div class="grid md:grid-cols-2 gap-8 items-center">
                            <div>
                                <h3 class="text-2xl font-bold text-stone-800">The Static Root (Sovereignty)</h3>
                                <p class="mt-4 text-lg text-stone-600">This is the cryptographic anchor of identity, grounded in a standard private key. It represents the immutable, sovereign self, aligning with the core tenets of Self-Sovereign Identity (SSI). This pillar provides the non-repudiable proof of authorship and control that is the bedrock of identity. It establishes the "who we are" in the digital realm as a self-owned, persistent entity.</p>
                                <p class="mt-4 text-stone-600">This component uses well-established cryptography (like ECDSA) to prove you are the owner of your identity, ensuring that all actions are verifiably yours. It is the stable foundation upon which the more dynamic layers are built.</p>
                            </div>
                            <div class="bg-stone-50 p-8 rounded-lg border border-stone-200 text-center">
                                <p class="font-mono text-sm text-stone-500">Message_Hash</p>
                                <p class="text-4xl my-4">‚¨áÔ∏è</p>
                                <div class="flex items-center justify-center space-x-4">
                                    <span class="text-5xl">üîë</span>
                                    <p class="text-2xl font-bold text-stone-700">+</p>
                                    <p class="font-mono text-sm bg-white p-3 rounded border border-stone-300">Private Key</p>
                                </div>
                                <p class="text-4xl my-4">‚¨áÔ∏è</p>
                                <p class="font-mono text-sm bg-teal-100 text-teal-800 p-3 rounded border border-teal-200">Standard Signature</p>
                            </div>
                        </div>
                    </div>

                    <div id="wellbeing-content" class="pillar-content mt-8">
                        <div class="grid md:grid-cols-2 gap-8 items-center">
                            <div>
                                <h3 class="text-2xl font-bold text-stone-800">The Dynamic State (Well-being)</h3>
                                <p class="mt-4 text-lg text-stone-600">This pillar introduces a real-time, quantitative measure of an individual's internal state, termed the "Coherence Score." It seeks to represent the "how we are" of identity, moving beyond static attributes to a dynamic reflection of psychophysiological well-being. This score is a verifiable snapshot of your internal alignment, pulled from the Holochain DHT.</p>
                                <p class="mt-4 text-stone-600">A higher score might indicate a state of calm, focus, and clarity, while a lower score could reflect stress or distraction. Use the slider to see how your state could affect your digital interactions.</p>
                                <div class="mt-6">
                                    <label for="coherence-slider" class="block text-sm font-medium text-stone-700">Adjust Coherence Score:</label>
                                    <input id="coherence-slider" type="range" min="0" max="100" value="75" class="w-full h-2 bg-stone-200 rounded-lg appearance-none cursor-pointer">
                                </div>
                            </div>
                            <div class="chart-container">
                                <canvas id="coherenceChart"></canvas>
                            </div>
                        </div>
                    </div>

                    <div id="relational-content" class="pillar-content mt-8">
                        <div class="grid md:grid-cols-2 gap-8 items-center">
                            <div>
                                <h3 class="text-2xl font-bold text-stone-800">The Relational Context (Health)</h3>
                                <p class="mt-4 text-lg text-stone-600">This component measures the quality and depth of the relationship between interacting parties, termed the "Covenant Resonance." It represents the "who we are with," asserting that identity is not formed in isolation but is co-created through social context. This score is a verifiable snapshot of the trust and health of a specific relationship.</p>
                                <p class="mt-4 text-stone-600">A high resonance score between two people indicates a history of positive, pro-social interactions. Click on the nodes in the diagram to explore how relationships form the fabric of this identity model.</p>
                            </div>
                            <div id="covenant-graph" class="h-96 bg-stone-50 rounded-lg border border-stone-200 p-4 relative cursor-pointer">
                                <!-- JS will render the graph here -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Section: The Protocol -->
        <section id="protocol" class="section py-12 md:py-20">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="text-center">
                    <h2 class="text-base font-semibold text-amber-600 tracking-wide uppercase">The Ceremony</h2>
                    <p class="mt-2 text-3xl font-extrabold text-stone-900 tracking-tight sm:text-4xl">The Sacred Weaving</p>
                    <p class="mt-5 max-w-3xl mx-auto text-xl text-stone-600">Creating and verifying a Resonant Signature is a multi-step computational ceremony. It combines standard cryptography with novel data retrieval from the Holochain network. This interactive diagram walks you through the process, highlighting both its elegance and its critical vulnerabilities. Use the buttons to navigate the flow.</p>
                </div>

                <div class="mt-12 grid md:grid-cols-3 gap-8">
                    <div class="md:col-span-2">
                        <div id="protocol-step-1" class="protocol-step active p-6 bg-white rounded-r-lg shadow-sm">
                            <span class="text-amber-600 font-bold">Step 1: Intention & Gathering</span>
                            <p class="mt-2 text-stone-600">The user initiates an action. Their client atomically fetches their current Coherence Score (üíß) and Covenant Resonance (üï∏Ô∏è) from the Holochain DHT.</p>
                        </div>
                        <div class="pl-6"><div class="flow-arrow active text-3xl h-12 flex items-center">‚Üì</div></div>
                        <div id="protocol-step-2" class="protocol-step p-6 bg-white rounded-r-lg shadow-sm">
                            <span class="text-amber-600 font-bold">Step 2: Forming the Moment</span>
                            <p class="mt-2 text-stone-600">A unique message is created by hashing the transaction data, a timestamp, and the two dynamic scores together.</p>
                        </div>
                        <div class="pl-6"><div class="flow-arrow text-3xl h-12 flex items-center">‚Üì</div></div>
                        <div id="protocol-step-3" class="protocol-step p-6 bg-white rounded-r-lg shadow-sm">
                            <span class="text-amber-600 font-bold">Step 3: Sealing the Covenant</span>
                            <p class="mt-2 text-stone-600">The user signs this unique hash with their Static Root private key (üîë).</p>
                        </div>
                        <div class="pl-6"><div class="flow-arrow text-3xl h-12 flex items-center">‚Üì</div></div>
                        <div id="protocol-step-4" class="protocol-step p-6 bg-white rounded-r-lg shadow-sm">
                            <span class="text-amber-600 font-bold">Step 4: Verification</span>
                            <p class="mt-2 text-stone-600">A verifier receives the signature bundle. They independently look up the signer's scores on the DHT to ensure they are recent and valid, then re-calculate the hash and verify the signature.</p>
                            <div id="vulnerability-warning" class="mt-3 hidden">
                                <div class="bg-red-100 border-l-4 border-red-500 text-red-700 p-4 rounded-md" role="alert">
                                    <p class="font-bold">Critical Vulnerability!</p>
                                    <p>This step is where the system can fail. Holochain's DHT has "eventual consistency," meaning the verifier's view of the scores might be stale compared to what the signer used. This can cause legitimate signatures to fail verification.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="bg-white p-6 rounded-lg shadow-md border border-stone-200 flex flex-col justify-center">
                        <h3 class="text-xl font-bold text-stone-800">Navigate the Protocol</h3>
                        <p class="text-stone-600 mt-2 mb-4">Follow the data as it's woven into a signature.</p>
                        <div class="space-y-3">
                            <button id="protocol-prev" class="w-full bg-stone-200 hover:bg-stone-300 text-stone-800 font-bold py-2 px-4 rounded transition-colors duration-200 disabled:opacity-50 disabled:cursor-not-allowed" disabled>Previous</button>
                            <button id="protocol-next" class="w-full bg-teal-600 hover:bg-teal-700 text-white font-bold py-2 px-4 rounded transition-colors duration-200">Next</button>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Section: Implications -->
        <section id="implications" class="section py-12 md:py-20 bg-white">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="text-center">
                    <h2 class="text-base font-semibold text-amber-600 tracking-wide uppercase">The Double-Edged Sword</h2>
                    <p class="mt-2 text-3xl font-extrabold text-stone-900 tracking-tight sm:text-4xl">Utopia or Dystopia?</p>
                    <p class="mt-5 max-w-3xl mx-auto text-xl text-stone-600">A system that can "naturally reject transactions from a place of incoherence" is both a beautiful promise and a terrifying threat. It could create a healthy, self-healing community or an oppressive system of algorithmic social control. Use the toggle to explore both sides of this powerful technology.</p>
                </div>

                <div class="mt-10 flex flex-col items-center space-y-4">
                    <div class="flex items-center space-x-3">
                        <span class="font-semibold text-teal-600">Utopian Vision</span>
                        <label for="implications-toggle" class="flex items-center cursor-pointer">
                            <div class="relative">
                                <input type="checkbox" id="implications-toggle" class="sr-only">
                                <div class="block bg-stone-200 w-14 h-8 rounded-full implications-toggle-bg"></div>
                            </div>
                        </label>
                        <span class="font-semibold text-red-600">Dystopian Risk</span>
                    </div>
                </div>

                <div id="utopian-view" class="utopian-view mt-8">
                    <div class="grid md:grid-cols-2 gap-8">
                        <div class="bg-teal-50 p-6 rounded-lg border border-teal-200">
                            <h3 class="text-xl font-bold text-teal-800">"Wise Contracts"</h3>
                            <p class="mt-2 text-teal-700">Smart contracts evolve to become context-aware. A vote's weight could be amplified by the voter's Coherence Score, rewarding presence and clarity. Access to critical roles could require a high coherence threshold, ensuring decisions are made from a centered state.</p>
                        </div>
                        <div class="bg-teal-50 p-6 rounded-lg border border-teal-200">
                            <h3 class="text-xl font-bold text-teal-800">An Immune System for Health</h3>
                            <p class="mt-2 text-teal-700">The system organically heals itself by marginalizing disruptive behavior. If a member's Coherence drops, their ability to influence the system is naturally diminished, not as punishment, but as a consequence of their dissonant state, fostering a culture of trust and well-being.</p>
                        </div>
                    </div>
                </div>

                <div id="dystopian-view" class="dystopian-view mt-8">
                    <div class="grid md:grid-cols-2 gap-8">
                         <div class="bg-red-50 p-6 rounded-lg border border-red-200">
                            <h3 class="text-xl font-bold text-red-800">Algorithmic Governance</h3>
                            <p class="mt-2 text-red-700">"Wise Contracts" become tools of exclusion. A passionate but agitated plea is algorithmically silenced. Neurodivergent individuals or those in crisis are locked out of governance. Emotional expression is penalized, enforcing a monoculture of performative calm.</p>
                        </div>
                        <div class="bg-red-50 p-6 rounded-lg border border-red-200">
                            <h3 class="text-xl font-bold text-red-800">A Decentralized Social Credit System</h3>
                            <p class="mt-2 text-red-700">The system becomes a tool for emotional surveillance. Dissent is classified as "incoherence." Unpopular but necessary actions that damage relational scores are punished. The "immune system" attacks not just bad actors, but anyone who challenges the status quo.</p>
                        </div>
                    </div>
                </div>

                <div class="mt-12 bg-stone-50 p-8 rounded-xl shadow-inner border border-stone-200">
                    <h3 class="text-2xl font-bold text-center text-stone-800 mb-6">Resonant Signature vs. Social Credit System</h3>
                    <p class="text-center text-stone-600 max-w-2xl mx-auto mb-8">While both systems score behavior, their underlying philosophy and control mechanisms differ profoundly. However, the potential for overlap is a critical ethical concern. This chart compares their key features.</p>
                    <div class="chart-container h-96 md:h-[450px]">
                        <canvas id="comparisonChart"></canvas>
                    </div>
                </div>

            </div>
        </section>
    </main>

    <footer class="bg-stone-800 text-stone-300">
        <div class="max-w-7xl mx-auto py-6 px-4 sm:px-6 lg:px-8 text-center text-sm">
            <p>This interactive application is a conceptual exploration based on the "Resonant Signature" report.</p>
            <p class="mt-1">Designed to make complex ideas accessible and to stimulate critical thinking about the future of identity.</p>
        </div>
    </footer>

<script>
document.addEventListener('DOMContentLoaded', () => {
    const sections = document.querySelectorAll('.section');
    const navLinks = document.querySelectorAll('.nav-link');
    const mobileNav = document.getElementById('mobile-nav');

    function setActiveSection(hash) {
        const targetId = hash.substring(1);
        sections.forEach(section => {
            if (section.id === targetId) {
                section.classList.add('active');
            } else {
                section.classList.remove('active');
            }
        });
        navLinks.forEach(link => {
            if (link.getAttribute('href') === hash) {
                link.classList.add('active');
            } else {
                link.classList.remove('active');
            }
        });
        if (mobileNav.value !== targetId) {
            mobileNav.value = targetId;
        }
    }

    function handleNavClick(e) {
        e.preventDefault();
        const hash = e.target.getAttribute('href');
        window.history.pushState(null, null, hash);
        setActiveSection(hash);
        window.scrollTo({ top: document.querySelector(hash).offsetTop - 64, behavior: 'smooth' });
    }

    navLinks.forEach(link => link.addEventListener('click', handleNavClick));
    mobileNav.addEventListener('change', (e) => {
        const hash = '#' + e.target.value;
        window.history.pushState(null, null, hash);
        setActiveSection(hash);
        window.scrollTo({ top: document.querySelector(hash).offsetTop - 64, behavior: 'smooth' });
    });

    window.addEventListener('popstate', () => {
        setActiveSection(window.location.hash || '#overview');
    });

    setActiveSection(window.location.hash || '#overview');

    // Pillar Tabs Logic
    const pillarTabs = document.querySelectorAll('.tab-button');
    const pillarContents = document.querySelectorAll('.pillar-content');

    pillarTabs.forEach(tab => {
        tab.addEventListener('click', () => {
            const targetId = tab.dataset.pillar + '-content';

            pillarTabs.forEach(t => t.classList.remove('active'));
            tab.classList.add('active');

            pillarContents.forEach(content => {
                if (content.id === targetId) {
                    content.classList.add('active');
                } else {
                    content.classList.remove('active');
                }
            });
        });
    });

    // Coherence Score Chart (Pillar 2)
    let coherenceChart;
    const coherenceSlider = document.getElementById('coherence-slider');
    const coherenceChartCtx = document.getElementById('coherenceChart')?.getContext('2d');

    function createCoherenceChart(value) {
        if (coherenceChart) {
            coherenceChart.destroy();
        }
        const data = {
            datasets: [{
                data: [value, 100 - value],
                backgroundColor: ['#0d9488', '#e5e7eb'],
                borderWidth: 0,
                circumference: 180,
                rotation: 270,
            }]
        };
        coherenceChart = new Chart(coherenceChartCtx, {
            type: 'doughnut',
            data: data,
            options: {
                responsive: true,
                maintainAspectRatio: false,
                cutout: '70%',
                plugins: {
                    legend: { display: false },
                    tooltip: { enabled: false }
                }
            }
        });
    }

    if (coherenceChartCtx) {
        createCoherenceChart(parseInt(coherenceSlider.value));
        coherenceSlider.addEventListener('input', (e) => {
            createCoherenceChart(parseInt(e.target.value));
        });
    }

    // Covenant Resonance Graph (Pillar 3)
    const covenantGraphContainer = document.getElementById('covenant-graph');
    if (covenantGraphContainer) {
        const nodes = [
            { id: 'You', x: 50, y: 50, size: 12 },
            { id: 'Anna', x: 25, y: 25, size: 8 },
            { id: 'Community', x: 75, y: 30, size: 10 },
            { id: 'Proposal', x: 70, y: 75, size: 8 },
            { id: 'Bob', x: 30, y: 80, size: 8 },
        ];
        const links = [
            { source: 'You', target: 'Anna', resonance: 9 },
            { source: 'You', target: 'Community', resonance: 7 },
            { source: 'You', target: 'Proposal', resonance: 5 },
            { source: 'You', target: 'Bob', resonance: 2 },
            { source: 'Anna', target: 'Community', resonance: 8 },
        ];

        function renderCovenantGraph() {
            covenantGraphContainer.innerHTML = '';
            links.forEach(link => {
                const sourceNode = nodes.find(n => n.id === link.source);
                const targetNode = nodes.find(n => n.id === link.target);
                const line = document.createElement('div');
                line.classList.add('absolute', 'bg-teal-300', 'transition-all', 'duration-300');
                line.style.height = `${link.resonance / 2}px`;
                const width = Math.hypot(targetNode.x - sourceNode.x, targetNode.y - sourceNode.y);
                const angle = Math.atan2(targetNode.y - sourceNode.y, targetNode.x - sourceNode.x) * 180 / Math.PI;
                line.style.width = `${width}%`;
                line.style.left = `${sourceNode.x}%`;
                line.style.top = `${sourceNode.y}%`;
                line.style.transformOrigin = '0 0';
                line.style.transform = `rotate(${angle}deg)`;
                line.dataset.source = link.source;
                line.dataset.target = link.target;
                covenantGraphContainer.appendChild(line);
            });

            nodes.forEach(node => {
                const nodeEl = document.createElement('div');
                nodeEl.classList.add('absolute', 'rounded-full', 'flex', 'items-center', 'justify-center', 'text-white', 'font-semibold', 'cursor-pointer', 'transition-all', 'duration-300', 'shadow-lg');
                nodeEl.style.width = `${node.size * 4}px`;
                nodeEl.style.height = `${node.size * 4}px`;
                nodeEl.style.left = `calc(${node.x}% - ${node.size * 2}px)`;
                nodeEl.style.top = `calc(${node.y}% - ${node.size * 2}px)`;
                nodeEl.style.fontSize = `${node.size * 1.2}px`;
                nodeEl.textContent = node.id === 'You' ? 'You' : '';
                nodeEl.dataset.id = node.id;
                nodeEl.classList.add(node.id === 'You' ? 'bg-amber-600' : 'bg-teal-600');

                const label = document.createElement('span');
                label.textContent = node.id;
                label.classList.add('absolute', '-bottom-6', 'text-stone-700', 'text-sm', 'font-medium');
                nodeEl.appendChild(label);

                covenantGraphContainer.appendChild(nodeEl);
            });

            covenantGraphContainer.addEventListener('click', (e) => {
                const targetNode = e.target.closest('[data-id]');
                if (!targetNode) return;

                const nodeId = targetNode.dataset.id;
                covenantGraphContainer.querySelectorAll('[data-id]').forEach(n => n.classList.remove('ring-4', 'ring-amber-400'));
                targetNode.classList.add('ring-4', 'ring-amber-400');

                covenantGraphContainer.querySelectorAll('div[data-source]').forEach(l => {
                    if (l.dataset.source === nodeId || l.dataset.target === nodeId) {
                        l.classList.remove('bg-teal-300');
                        l.classList.add('bg-amber-500');
                        l.style.zIndex = '10';
                    } else {
                        l.classList.remove('bg-amber-500');
                        l.classList.add('bg-teal-300');
                        l.style.zIndex = '0';
                    }
                });
            });
        }
        renderCovenantGraph();
    }

    // Protocol Flow Logic
    const protocolPrevBtn = document.getElementById('protocol-prev');
    const protocolNextBtn = document.getElementById('protocol-next');
    const protocolSteps = document.querySelectorAll('.protocol-step');
    const flowArrows = document.querySelectorAll('.flow-arrow');
    const vulnerabilityWarning = document.getElementById('vulnerability-warning');
    let currentStep = 1;

    function updateProtocolView() {
        protocolSteps.forEach((step, index) => {
            if (index + 1 <= currentStep) {
                step.classList.add('active');
            } else {
                step.classList.remove('active');
            }
        });
        flowArrows.forEach((arrow, index) => {
            if (index + 1 < currentStep) {
                arrow.classList.add('active');
            } else {
                arrow.classList.remove('active');
            }
        });

        vulnerabilityWarning.style.display = (currentStep === 4) ? 'block' : 'none';

        protocolPrevBtn.disabled = currentStep === 1;
        protocolNextBtn.disabled = currentStep === 4;
    }

    protocolNextBtn.addEventListener('click', () => {
        if (currentStep < 4) {
            currentStep++;
            updateProtocolView();
        }
    });

    protocolPrevBtn.addEventListener('click', () => {
        if (currentStep > 1) {
            currentStep--;
            updateProtocolView();
        }
    });

    // Implications Toggle Logic
    const implicationsToggle = document.getElementById('implications-toggle');
    const utopianView = document.getElementById('utopian-view');
    const dystopianView = document.getElementById('dystopian-view');
    let comparisonChart;
    const comparisonChartCtx = document.getElementById('comparisonChart')?.getContext('2d');

    const comparisonData = {
        labels: ['Behavioral Scoring', 'Rewards/Punishments', 'Control Mechanism', 'Core Goal'],
        utopian: {
            rs: [8, 7, 9, 9],
            scs: [5, 4, 2, 3]
        },
        dystopian: {
            rs: [7, 8, 8, 4],
            scs: [9, 9, 3, 3]
        }
    };

    function createComparisonChart(view) {
        if (comparisonChart) {
            comparisonChart.destroy();
        }
        const data = {
            labels: comparisonData.labels,
            datasets: [
                {
                    label: 'Resonant Signature',
                    data: comparisonData[view].rs,
                    backgroundColor: view === 'utopian' ? 'rgba(13, 148, 136, 0.6)' : 'rgba(220, 38, 38, 0.6)',
                    borderColor: view === 'utopian' ? '#0d9488' : '#dc2626',
                    borderWidth: 2
                },
                {
                    label: 'Social Credit System',
                    data: comparisonData[view].scs,
                    backgroundColor: 'rgba(113, 113, 122, 0.5)',
                    borderColor: '#71717a',
                    borderWidth: 2
                }
            ]
        };
        comparisonChart = new Chart(comparisonChartCtx, {
            type: 'bar',
            data: data,
            options: {
                indexAxis: 'y',
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    x: {
                        beginAtZero: true,
                        max: 10,
                        grid: { color: 'rgba(0,0,0,0.05)' },
                        ticks: {
                            callback: function(value) {
                                if (value === 0) return 'Low Risk/Benefit';
                                if (value === 10) return 'High Risk/Benefit';
                                return '';
                            }
                        }
                    },
                    y: {
                        grid: { display: false }
                    }
                },
                plugins: {
                    legend: {
                        position: 'top',
                    },
                    tooltip: {
                        enabled: true
                    }
                }
            }
        });
    }

    function updateImplicationsView() {
        if (implicationsToggle.checked) { // Dystopian
            utopianView.style.display = 'none';
            dystopianView.style.display = 'block';
            if(comparisonChartCtx) createComparisonChart('dystopian');
        } else { // Utopian
            utopianView.style.display = 'block';
            dystopianView.style.display = 'none';
            if(comparisonChartCtx) createComparisonChart('utopian');
        }
    }

    implicationsToggle.addEventListener('change', updateImplicationsView);

    // Initial calls
    updateProtocolView();
    updateImplicationsView();
});
</script>
</body>
</html>
